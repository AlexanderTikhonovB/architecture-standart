### <a name="_b7urdng99y53"></a>**Название задачи:** 
### <a name="_hjk0fkfyohdk"></a>**Автор:**
### <a name="_uanumrh8zrui"></a>**Дата:**
### <a name="_3bfxc9a45514"></a>**Функциональные требования**
Опишите здесь верхнеуровневые Use Cases. Их нужно оформить в виде таблицы с пошаговым описанием:

| **№** | **Действующие лица или системы** | **Use Case**                                       | **Описание**                                                                                                                                                                                                        |
|:-----:|:---------------------------------|:---------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|       | Пользователь                     | Заявка депозит не зарегистрированного пользователя | 1. Пользователь открывает сайт Банка                                                                                                                                                                                |
|       |                                  |                                                    | 2. Пользователь выбирает раздел депозитов                                                                                                                                                                           |
|       |                                  |                                                    | 3. В открывшемся окне отражается список доступных депозитов с актуальными ставками                                                                                                                                  |
|       |                                  |                                                    | 4. Пользователь выбирает раздел - заявка на депозит                                                                                                                                                                 |
|       |                                  |                                                    | 5. Открывается меню с просьбой ввести ФИО и номер телефона                                                                                                                                                          |
|       |                                  |                                                    | 6. Пользователь вводит данные и нажимает отправить                                                                                                                                                                  |
|       |                                  |                                                    | 7. Система проверяет наличие номера в базе зарегистрированных пользователей                                                                                                                                         |
|       |                                  |                                                    | 8. Если пользователь зарегистрирован - предлагается перейти в интернет-банк, окно заявки закрывается, открывается окно регистрации в интернет-банке                                                                 |
|       |                                  |                                                    | 9. Если пользователь не зарегистрирован система отправляет пользователю СМС, передает код в интернет-банк, открывается окно ввода СМС кода                                                                          |
|       |                                  |                                                    | 9. Если СМС код введен успешно, заявка отправляется в систему Call-центра, окно заявки закрывается, пользователю выдается сообщение о запланированном звонке менеджера                                              |
|       |                                  |                                                    | 10. Если СМС код введен неуспешно n раз или не введен в течении х времени, окно ввода СМС кода закрывается, осуществляется переход в окно заявки на депозит                                                         |
|       |                                  |                                                    | 11. Пользователь может выбрать пункт - закрыть заявку на депозит, осуществляется переход на главную страницу сайта                                                                                                  |
|       |                                  |                                                    |                                                                                                                                                                                                                     |
|       | Менеджер Call-Центра             |                                                    | 1. Менеджер Call-Центра получает уведомление о создании заявки на депозит                                                                                                                                           |
|       |                                  |                                                    | 2. Менеджер изучает заявку и на основании внутренних процессов выбирает доступную ставку по депозиту                                                                                                                |
|       |                                  |                                                    | 3. Менеджер звонит по телефону в заявке и предлагает пользователю явиться в отделение банка                                                                                                                         |
|       |                                  |                                                    | 4. Если пользователь соглашается, менеджер согласовывает время посещения отделения и перечисляет список необходимых документов                                                                                      |
|       |                                  |                                                    |                                                                                                                                                                                                                     |
|       | Пользователь                     | Предоставление документов для регистрации          | 1. Пользователь посещает отделение Банка                                                                                                                                                                            |
|       |                                  |                                                    | 2. Пользователь предоставляет необходимые документы сотруднику отделения                                                                                                                                            |
|       |                                  |                                                    |                                                                                                                                                                                                                     |
|       | Сотрудник отделения              | Регистрация нового пользователя                    | 1. Сотрудник отделения получает документы пользователя                                                                                                                                                              |
|       |                                  |                                                    | 2. Сотрудник проверяет документы пользователя на подлинность                                                                                                                                                        |
|       |                                  |                                                    | 3. Сотрудник проверяет документы пользователя в системе на регистрацию данного пользователя с другим номером телефона по предоставленным документам                                                                 |
|       |                                  |                                                    | 4. Если пользователь является зарегистрированным, сотрудник отделения предлагает изменить в системе номер телефона зарегистрированного пользователя                                                                 |
|       |                                  |                                                    | 5. Если пользователь является зарегистрированным и согласен изменить номер - сотрудник изменяет номер в системе                                                                                                     |
|       |                                  |                                                    | 6. Система отправляет пользователю СМС, передает код в интернет-банк, у сотрудника отделения открывается окно ввода СМС кода                                                                                        |
|       |                                  |                                                    | 7. Если зарегистрированный пользователь не может предоставить СМС код сотрудник завершает обслуживание зарегистрированного пользователя                                                                             |
|       |                                  |                                                    | 8. Если СМС код введен успешно система изменяет номер зарегистрированного пользователя                                                                                                                              |
|       |                                  |                                                    | 9. Если пользователь не зарегистрирован сотрудник регистрирует пользователя в системе                                                                                                                               |
|       |                                  |                                                    | 10. После регистрации сотрудник нажимает "сохранить данные", система оправляет пользователю СМС, передает код в интернет-банк, у сотрудника отделения открывается окно ввода СМС кода                               |
|       |                                  |                                                    | 11. Если зарегистрированный пользователь не может предоставить СМС код сотрудник завершает обслуживание не зарегистрированного пользователя                                                                         |
|       |                                  |                                                    | 12. Если код введен успешно пользователь регистрируется в системе                                                                                                                                                   |
|       |                                  |                                                    |                                                                                                                                                                                                                     |
|       | Зарегистрированный пользователь  | Аутентификация                                     | 1. Зарегистрированный пользователь открывает интернет-банк и вводит свой номер телефона                                                                                                                             |
|       |                                  |                                                    | 2. Серверная часть интернет-банка проверяет регистрацию пользователя                                                                                                                                                |
|       |                                  |                                                    | 3. Если нет совпадения по номеру телефона в клиентской части интернет банка отражается ошибка. Если есть, открывается окно для ввода пароля                                                                         |
|       |                                  |                                                    | 4. Пользователь вводит пароль. Если пароль не совпал то возвращается ошибка и предложение повторить                                                                                                                 |
|       |                                  |                                                    | 5. Если пароль не совпал n раз клиентское приложение закрывается (определить - пользователь должен обратиться в офис, повторить попытку через х времени, или предложить смену пароля через подтверждение через СМС) |
|       |                                  |                                                    | 6. Если пароль совпал - происходит переход на главную страницу                                                                                                                                                      |
|       |                                  |                                                    | 7. Система запрашивает счета и суммы у ABS и загружает  новую систему Интернет-Банк                                                                                                                                 |
|       |                                  |                                                    |                                                                                                                                                                                                                     |
|       | Авторизованный пользователь      | Заявка на депозит                                  | 1. На главной странице пользователь выбирает раздел депозиты                                                                                                                                                        |
|       |                                  |                                                    | 2. В открывшемся разделе пользователь выбирает открыть депозит                                                                                                                                                      |
|       |                                  |                                                    | 3. Открывается раздел с актуальными и персонализированными ставками (вычисленными по шаблону)                                                                                                                       |
|       |                                  |                                                    | 4. Пользователь выбирает ставку депозита                                                                                                                                                                            |
|       |                                  |                                                    | 5. Открывается меню с выбором имеющихся счетов пользователя                                                                                                                                                         |
|       |                                  |                                                    | 6. Пользователь выбирает доступный счет                                                                                                                                                                             |
|       |                                  |                                                    | 7. Система проверяет доступность средств и открывается меню с выбором средств                                                                                                                                       |
|       |                                  |                                                    | 8. Пользователь указывает сумму (клиентская часть интернет-банка проверяет вводимую сумму и не позволяет превысить доступные на счету средства)                                                                     |
|       |                                  |                                                    | 9. Пользователь подтверждает перевод средств со счета на депозит                                                                                                                                                    |
|       |                                  |                                                    | 10. Система создает запрос менеджеру Депозитов на подтверждение ставки, проверяет события в kafka по движению по счету клиента, резервирует сумму на счете                                                          |
|       |                                  |                                                    | 11. Менеджер проверяет предложенный запрос и принимает решение по ставке                                                                                                                                            |
|       |                                  |                                                    | 12. При подтверждении ставки и отправляет пользователю СМC                                                                                                                                                          |
|       |                                  |                                                    | 13. Система разблокирует средства на счете и переводит средства на депозит                                                                                                                                          |
|       |                                  |                                                    | 14. При отказе система отправляет СМС код и разблокирует сумму на счете                                                                                                                                             |
|       |                                  |                                                    |                                                                                                                                                                                                                     |
|       | Новый интернет банк              |                                                    | 1. Получает ставку из почтовой системы                                                                                                                                                                              |
|       |                                  |                                                    | 2. По заложенному алогоритму проводиться расчет депозитных ставок                                                                                                                                                   |
|       |                                  |                                                    | 3. Менеджер проверяет рекомандованные ставки и подтверждает публикацию на внутреннем портале                                                                                                                        |
|       |                                  |                                                    |                                                                                                                                                                                                                     |
### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**
Опишите здесь нефункциональные требования и архитектурно значимые требования.

| **№** | **Требование**                                                                                            |
|:--:|:----------------------------------------------------------------------------------------------------------|
|    | При оформлении доработок в интернет-банке должны использоваться общебанковские шрифты, цвета и оформление |
|    | получаемые из ЦБ ставка должна автоматически добавляться в АБС                                            |
|    | Вести депозитные ставки в АБС                                                                             |
|    |                                                                                                           |
|    | 24/7 и доступность 99.9% интернет банк, сайт, АБС                                                         |
|    | В случае сбоев ЦОД, должно происходить перключение на резервный ЦОД                                       |
|    |                                                                                                           |
|    | Максимальная скорость 300 м.с. отклика приложения                                                         |
|    | Горизонтальное масштабирование интернет банка и сайта                                                     |
|    |                                                                                                           |
|    | При разработке нового функционала необходимо использовать БД PostgreSQL                                   |
|    | Для передачи событий при разработке функционала использовать Kafka (необходима доработка интернет банка)  |
|    | Использованное ПО должно быть вендорнезависимым (желательно зарегистрированным в РОПО)                    | 
|    | React.js, бэкенд на Java Spring Boot - Call-цент и Сайт                                                   |
|    | При MVP по возможноси использовать Django/FastAPI для интернет-банка                                      |
### <a name="_qmphm5d6rvi3"></a>**Решение**
Приведите диаграммы контекста и контейнеров в модели C4. Опишите там основные компоненты и интеграции всех элементов решения. 

Для соблюдения приемственности системы интернет банка (важно для сохранения лояльных клиентов) используется подход strangler fig
Для уменьшения нагрузки на АБС уменьшается количество запросов к АБС в процессе подбора депозита (разовая загрузка после регистрации клиента в интернет банке)
Для предотвращения конфликта средств на счету (создаем kafka producer который записывает движения по счетам клиентв в топик), на топик подписывается новый интернет банк и вносит, при необходимости, изменения в загруженные счета
После перечисления средств на депозит вызывается API АБС для записи изменений, провоить данные операции по kafka представляется не целесообразным из за "возможно сложных" доработок в АБС
Сайт переделывается (при наличии времени) для хранения статического контента вне АБС (необходимо определить как обновляется контент, по запросу/событию или по crone)
Разрабатывается pop3 клиент для получения ставок присланных из ЦБ и загрузки из в новый интернет банк
Должент быть разработан типовой калькулятор персональных ставок, что бы ускорить принятие решение менеджером депозитов

Также опишите, какой логикой вы руководствовались в ходе принятия решений и выбора технологий. Не забывайте, что необходимо учесть все функциональные и нефункциональные требования.
### <a name="_bjrr7veeh80c"></a>**Альтернативы**
Опишите здесь наиболее важные альтернативные решения.
Доработка интернет банка в текущем состоянии - большие риски по рефакторингу кода и возможное нарушение привычного интерфейса для лояльных клиентов
Рассматривался вариант с запросами к АБС из нового интернет банка по всем шагам клиента - риск по ограничению пропускной способности АБС
Разработка сайта на Django - отклонили, увеличение времени на освоение нового стека командой
Принято решение по разработке интернет банка на node.js - для высоконагруженных реалтайм систем

**Недостатки, ограничения, риски**
Доработка АБС для интеграции с Kafka - может привести к рискам по срокам проекта
Поддержка вендорнезависимого ПО PostgreSQL потребует новых навыков поддержки
Требуется освоение framework Django
Требуется использование контейнерной технологии для горизонтального масштарибрования в ЦОД
Требуется использование балансировщика для поддержки HA



